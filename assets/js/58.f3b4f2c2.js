(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{622:function(t,a,s){"use strict";s.r(a);var v=s(17),_=Object(v.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h3",{attrs:{id:"数据结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据结构"}},[t._v("#")]),t._v(" 数据结构")]),t._v(" "),s("ul",[s("li",[t._v("Redis的数据类型有哪些?")]),t._v(" "),s("li",[t._v("说说 Redis 哈希槽的概念？")]),t._v(" "),s("li",[t._v("Hash如何实现O(1)的查询和设置速度, 以及扩容原理")]),t._v(" "),s("li",[t._v("布隆过滤器")])]),t._v(" "),s("h4",{attrs:{id:"redis的数据类型有哪些"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redis的数据类型有哪些"}},[t._v("#")]),t._v(" Redis的数据类型有哪些？")]),t._v(" "),s("p",[t._v("出现概率: ★★★★★")]),t._v(" "),s("p",[t._v("这个在面试的过程出现的概率特别高了。")]),t._v(" "),s("p",[s("font",{attrs:{color:"#FF000"}},[t._v("Redis 支持五种常用的数据类型：string（ 字符串），hash（ 哈希）， list（ 列表）， set（ 集合） 及 zsetsorted set：有序集合)")]),t._v("。")],1),t._v(" "),s("p",[s("img",{attrs:{src:"https://images.xiaozhuanlan.com/uploads/photo/2022/395d0a03-1f7d-4d6f-911d-7190600a3b10.png",alt:""}})]),t._v(" "),s("p",[t._v("redis 的基本数据结构对应的底层实现如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://images.xiaozhuanlan.com/uploads/photo/2022/6e26ec1d-8d45-4e35-9c6c-09033586309d.png",alt:""}})]),t._v(" "),s("p",[t._v("1)、Redis 的字符串是"),s("font",{attrs:{color:"#FF000"}},[t._v("动态字符串")]),t._v("，是可以修改的字符串，内部结构实现上类似于 Java 的 ArrayList，采用"),s("font",{attrs:{color:"#FF000"}},[t._v("预分配冗余空间")]),t._v("的方式来减少内存的频繁分配，如图所示：")],1),t._v(" "),s("p",[t._v("len 是当前字符串实际长度，capacity 是为字符串分配的可用空间，当字符串长度小于 1M 时，扩容都是加倍现有的空间，如果超过 1M，扩容时一次只会多扩 1M 的空间。字符串最大长度为 512M。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://images.xiaozhuanlan.com/uploads/photo/2022/5fce194c-eb39-41eb-9f48-474c38f0dc73.png",alt:""}})]),t._v(" "),s("p",[t._v("2)、hash")]),t._v(" "),s("p",[t._v("Redis Hash通过"),s("font",{attrs:{color:"#FF000"}},[t._v("分桶的方式")]),t._v("解决 hash 冲突。它是无序字典。内部实现结构是同样的"),s("font",{attrs:{color:"#FF000"}},[t._v("数组 + 链表二维结构")]),t._v("。第一维 hash 的数组位置碰撞时，就会将碰撞的元素使用链表串接起来。第一维是数组，第二维是链表。数组中存储的是第二维链表的第一个元素的指针。")],1),t._v(" "),s("p",[s("img",{attrs:{src:"https://images.xiaozhuanlan.com/uploads/photo/2022/3ef784a8-0ce9-42af-bb84-076b6fa09839.png",alt:""}})]),t._v(" "),s("p",[t._v("3)、list")]),t._v(" "),s("p",[t._v("Redis 的列表相当于 Java 语言中的 LinkedList，注意"),s("font",{attrs:{color:"#FF000"}},[t._v("它是链表而不是数组")]),t._v("。这意味着 list 的插入和删除操作非常快，时间复杂度为 O(1)，但是"),s("font",{attrs:{color:"#FF000"}},[t._v("索引定位很慢")]),t._v("，时间复杂度为 O(n)。")],1),t._v(" "),s("p",[t._v("list的特点是:")]),t._v(" "),s("ul",[s("li",[t._v("有序")]),t._v(" "),s("li",[t._v("可以重复")]),t._v(" "),s("li",[t._v("右边进左边出或者左边进右边出，则列表可以充当队列")]),t._v(" "),s("li",[t._v("左边进左边出或者右边进右边出，则列表可以充当栈")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://images.xiaozhuanlan.com/uploads/photo/2022/7b545730-f7fc-4a81-a0a8-afc3758f196a.png",alt:""}})]),t._v(" "),s("p",[t._v("4)、set")]),t._v(" "),s("p",[s("font",{attrs:{color:"#FF000"}},[t._v("set和字典非常类似")]),t._v("，其内部实现就是上述的hashTable的特殊实现，与字典不同的地方有两点：")],1),t._v(" "),s("ul",[s("li",[t._v("只关注key值，所有的value都是NULL。")]),t._v(" "),s("li",[t._v("在新增数据时会进行去重。")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://images.xiaozhuanlan.com/uploads/photo/2022/0215349d-fcc7-4eaf-a199-13f7ae225b33.png",alt:""}})]),t._v(" "),s("p",[t._v("5)、zsetsorted set")]),t._v(" "),s("p",[t._v("zset是Redis非常有特色的数据结构，它是基于Set并提供排序的有序集合。其中最为重要的特点就是支持通过score的权重来指定权重。一些排行榜、延迟任务比如指定1小时后执行, 就是使用这个数据结构实现的。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://images.xiaozhuanlan.com/uploads/photo/2022/121dc53f-a84d-46a4-b06c-a86c8e8f8a65.png",alt:""}})]),t._v(" "),s("p",[t._v("6)、"),s("strong",[t._v("拓展篇")])]),t._v(" "),s("p",[t._v("如果你说你还知道一些其他的几种数据结构比如: HyperLogLog、Geo、Pub/Sub、Redis Module，BloomFilter，RedisSearch，Redis-ML，面试官得眼睛就开始发亮了。")]),t._v(" "),s("p",[t._v("Redis5.0带来了Stream类型。从字面上看是流类型，但其实从功能上看，应该是Redis对消息队列（MQ，Message Queue）的完善实现。用过Redis做消息队列的都了解，基于Reids的消息队列实现有很多种，例如：")]),t._v(" "),s("ul",[s("li",[t._v("PUB/SUB，订阅/发布模式")]),t._v(" "),s("li",[t._v("基于List的 LPUSH+BRPOP 的实现")]),t._v(" "),s("li",[t._v("基于Sorted-Set的实现")])]),t._v(" "),s("p",[t._v("Redis Stream的结构如图所示，它有一个消息链表，将所有加入的消息都串起来，每个消息都有一个唯一的ID和对应的内容。消息是持久化的，Redis重启后，内容还在。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://images.xiaozhuanlan.com/uploads/photo/2022/48a57d0c-934b-4172-9783-3abb6a06b408.png",alt:""}})]),t._v(" "),s("h4",{attrs:{id:"hash如何实现o-1-的查询和设置速度-以及扩容原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hash如何实现o-1-的查询和设置速度-以及扩容原理"}},[t._v("#")]),t._v(" Hash如何实现O(1)的查询和设置速度, 以及扩容原理")]),t._v(" "),s("p",[t._v("出现概率: ★★★★★")]),t._v(" "),s("p",[s("font",{attrs:{color:"#FF000"}},[t._v("Redis Hash通过分桶的方式解决 hash 冲突。它是无序字典。内部实现结构是同样的数组 + 链表二维结构")]),t._v("。第一维 hash 的数组位置碰撞时，就会将碰撞的元素使用链表串接起来。第一维是数组，第二维是链表。数组中存储的是第二维链表的第一个元素的指针。")],1),t._v(" "),s("p",[t._v("因为是通过数组取模的方式, 可以实现O(1)的查询和设置速度。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://images.xiaozhuanlan.com/uploads/photo/2022/3ef784a8-0ce9-42af-bb84-076b6fa09839.png",alt:""}})]),t._v(" "),s("p",[t._v("不过如果概率多时, 链表长度过长时，查询时间复杂度会降低到O(n)。这个需要进行扩容了。")]),t._v(" "),s("p",[s("font",{attrs:{color:"#FF000"}},[t._v("大字典的扩容")]),t._v("是非常耗时间的，需要"),s("font",{attrs:{color:"#FF000"}},[t._v("重新申请新的数组")]),t._v("，正常情况下，当 hash 表中元素的个数等于第一维数组的长度时，就会开始扩容，扩容的新数组是原数组大小的 2 倍，然后将旧字典所有链表中的元素重新挂接到新的数组下面，这是一个 O(n)级别的操作，Redis 使用渐进式 rehash 扩容，分多次来慢慢的将旧数组中的键值对rehash到新数组的操作就称之为渐进式rehash。渐进式rehash可以避免了集中式rehash带来的庞大计算量，在渐进式rehash过程中，因为还可能会有新的键值对存进来，此时Redis的做法是新添加的键值对统一放入ht[1]中，这样就确保了ht[0]键值对的数量只会减少，当执行rehash操作时需要执行查询操作，此时会先查询ht[0]，查找不到结果再到ht[1]中查询。")],1),t._v(" "),s("h4",{attrs:{id:"说说-redis-哈希槽的概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#说说-redis-哈希槽的概念"}},[t._v("#")]),t._v(" 说说 Redis 哈希槽的概念？")]),t._v(" "),s("p",[t._v("出现概率: ★★★")]),t._v(" "),s("p",[t._v("Redis集群没有使用一致性hash,而是引入了哈希槽的概念，"),s("font",{attrs:{color:"#FF000"}},[t._v("Redis集群有16384个哈希槽")]),t._v("，每个key通过CRC16校验后对16384取模来决定放置哪个槽，集群的每个节点负责一部分hash槽。")],1),t._v(" "),s("h4",{attrs:{id:"布隆过滤器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#布隆过滤器"}},[t._v("#")]),t._v(" 布隆过滤器")]),t._v(" "),s("p",[t._v("出现概率: ★★★")]),t._v(" "),s("p",[t._v("这个在面试中出现的概率, 主要看面试官的偏好, 不过如果问到，而且你能回答比较好的， 估计是一个比较好的加分项。")]),t._v(" "),s("p",[t._v("布隆过滤器是 Redis 的高级功能，虽然这种结构的去重率并不完全精确，但和其他结构一样都有特定的应用场景，比如当处理"),s("font",{attrs:{color:"#FF000"}},[t._v("海量数据时")]),t._v("，就可以使用布隆过滤器实现去重。")],1),t._v(" "),s("p",[t._v("一些场景: 百度爬虫系统每天会面临海量的 URL 数据，我们希望它每次只爬取最新的页面，而对于没有更新过的页面则不爬取，因策爬虫系统必须对已经抓取过的 URL 去重，否则会严重影响执行效率。但是如果使用一个 set（集合）去装载这些 URL 地址，那么将造成资源空间的严重浪费。")]),t._v(" "),s("p",[t._v("布隆过滤器（Bloom Filter）是一个高空间利用率的概率性数据结构，由二进制向量（即位数组）和一系列随机映射函数（即哈希函数）两部分组成。")]),t._v(" "),s("p",[t._v("布隆过滤器使用exists()来判断某个元素是否存在于自身结构中。当布隆过滤器判定某个值存在时，其实这个值只是有可能存在；当它说某个值不存在时，那这个值肯定不存在，这个误判概率大约在 1% 左右。")]),t._v(" "),s("p",[s("strong",[t._v("Bloom Filter的原理")])]),t._v(" "),s("p",[t._v("1)、工作流程-添加元素")]),t._v(" "),s("p",[t._v("布隆过滤器主要由位数组和一系列 hash 函数构成，其中位数组的初始状态都为 0。")]),t._v(" "),s("p",[t._v("下面对布隆过滤器工作流程做简单描述，如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://images.xiaozhuanlan.com/uploads/photo/2022/13eb793d-1a5a-4c03-9d36-9bdc2380829a.png",alt:""}})]),t._v(" "),s("p",[t._v("2)、工作流程-判定元素是否存在")]),t._v(" "),s("p",[t._v("当我们需要判断一个元素是否存时，其流程如下：首先对给定元素再次执行哈希计算，得到与添加元素时相同的位数组位置，判断所得位置是否都为 1，如果其中有一个为 0，那么说明元素不存在，若都为 1，则说明元素有可能存在。")]),t._v(" "),s("p",[t._v("3)、 为什么是可能“存在”")]),t._v(" "),s("p",[t._v("您可能会问，为什么是有可能存在？其实原因很简单，那些被置为 1 的位置也可能是由于其他元素的操作而改变的。比如，元素1 和 元素2，这两个元素同时将一个位置变为了 1（图1所示）。在这种情况下，我们就不能判定“元素 1”一定存在，这是布隆过滤器存在误判的根本原因。")]),t._v(" "),s("p",[s("strong",[t._v("Bloom Filter的缺点")])]),t._v(" "),s("p",[t._v("bloom filter"),s("font",{attrs:{color:"#FF000"}},[t._v("牺牲了判断的准确率、删除的便利性")]),t._v(" ，才做到在时间和空间上的效率比较高，是因为")],1),t._v(" "),s("p",[t._v("1)、存在误判，可能要查到的元素并没有在容器中，但是hash之后得到的k个位置上值都是1。如果bloom filter中存储的是黑名单，那么可以通过建立一个白名单来存储可能会误判的元素。")]),t._v(" "),s("p",[t._v("2)、删除数据。一个放入容器的元素映射到bit数组的k个位置上是1，删除的时候不能简单的直接置为0，可能会影响其他元素的判断。可以考虑Counting Bloom Filter")]),t._v(" "),s("p",[t._v("也欢迎关注我的公众号: "),s("code",[t._v("漫步coding")]),t._v("。 一起交流, 在coding的世界里漫步, 回复: "),s("font",{attrs:{color:"#FF000"}},[s("code",[t._v("redis")])]),t._v(", 免费获取最新Redis面试题(含答案)。")],1),t._v(" "),s("p",[s("img",{attrs:{src:"https://images.xiaozhuanlan.com/uploads/photo/2022/5cb0c91e-fd83-4a04-8df6-65fb602b3834.png",alt:""}})]),t._v(" "),s("p",[t._v("希望这篇文章可以帮助大家, 也希望大家都能找到的好工作。")])])}),[],!1,null,null,null);a.default=_.exports}}]);